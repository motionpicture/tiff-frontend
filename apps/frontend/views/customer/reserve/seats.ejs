<h1>座席選択</h1>

<div class="row">
    <div class="table-responsive">
        <table class="table table-bordered">

            <tbody>
                <tr>
                <% performance.screen.sections[0].seats.forEach(function(seat, index) { %>
                    <% if (index % 12 === 0) { %>
                    </tr>
                    <tr>
                    <% } %>

                    <% if (stocksBySeatCode.hasOwnProperty(seat.code)) { %>
                        <% let stock = stocksBySeatCode[seat.code] %>

                        <% if (stock.status === 'AVAILABLE') { %>
                        <!-- 予約可能 -->
                        <th scope="row" class="select-seat" data-code="<%- seat.code %>" data-id="<%- stock._id %>">
                            <%- seat.code %>
                        </th>
                        <% } else { %>
                        <!-- 予約不可 -->
                        <th scope="row" class="bg-danger">
                            <%- seat.code %>
                        </th>
                        <% } %>

                    <% } else { %>
                        <!-- 未販売 -->
                        <th scope="row" class="bg-warning text-muted">
                            <%- seat.code %>
                        </th>

                    <% } %>

                <% }) %>
                </tr>
            </tbody>

        </table>
    </div>

    <a class="btn btn-default btn-lg btn-block" href="<%- url('customer.reserve.performances', {token: req.params.token}) %>">戻る</a>
    <a class="btn btn-primary btn-lg btn-block select-seats" href="javascript:void(0);">券種選択</a>
</div>


<script>
$(function(){
    $('.select-seat').on('click', function(){
        $(this).toggleClass('bg-primary');
    });

    $('.select-seats').on('click', function(){
        var stockIds = [];

        // 座席コードリストを取得
        $('.select-seat.bg-primary').each(function(index){
            var stockId = $(this).attr('data-id');
            stockIds.push(stockId);
        });

        $('form input[name="stockIds"]').val(JSON.stringify(stockIds));
        $('form').submit();
    });

    // $('.select-tickets').on('click', function(){
    //     // 座席コードリストを取得
    //     var choices = [];
    //     $('.tickets tbody tr').not('.hidden').each(function(index){
    //         choices.push({
    //             code: $(this).attr('data-code'),
    //             ticket: {
    //                 type: $('select', this).val(),
    //                 name: $('option:selected', this).attr('data-name'),
    //                 name_en: $('option:selected', this).attr('data-name-en'),
    //                 price: $('option:selected', this).attr('data-price'),
    //             }
    //         });
    //     });
    // });
});
</script>

<form method="post">
<%- form.toHTML() %>
</form>

